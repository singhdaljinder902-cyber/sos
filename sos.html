<!DOCTYPE html>
<html>
<head>
  <title>Safe Sakhi SOS</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body style="margin:0;height:100vh;display:flex;
justify-content:center;align-items:center;background:#8b0000;">

<!-- SETUP SCREEN -->
<div id="setup" style="display:none;text-align:center;color:white;">
  <h2>Set Parent WhatsApp Numbers</h2>

  <input id="parent1" type="tel" placeholder="Parent 1 (91XXXXXXXXXX)"
    style="font-size:18px;padding:10px;width:240px;"><br><br>

  <input id="parent2" type="tel" placeholder="Parent 2 (91XXXXXXXXXX)"
    style="font-size:18px;padding:10px;width:240px;"><br><br>

  <button onclick="saveNumbers()" style="font-size:18px;padding:10px;">
    Save Numbers
  </button>
</div>

<!-- SOS SCREEN -->
<div id="sos" style="display:none;text-align:center;">
  <button onclick="startSOS()" style="
    background:red;color:white;font-size:30px;
    padding:30px 50px;border:none;border-radius:18px;">
    ðŸš¨ SOS
  </button>
  <br><br>
  <button onclick="changeNumbers()" style="
    font-size:14px;padding:8px 14px;border:none;border-radius:10px;">
    Change Parent Numbers
  </button>
</div>

<audio id="siren" loop>
  <source src="siren.mp3" type="audio/mpeg">
</audio>

<script>
const p1 = localStorage.getItem("parent1");
const p2 = localStorage.getItem("parent2");

if (p1 || p2) {
  document.getElementById("sos").style.display = "block";
} else {
  document.getElementById("setup").style.display = "block";
}

function saveNumbers() {
  const n1 = document.getElementById("parent1").value.trim();
  const n2 = document.getElementById("parent2").value.trim();

  if (n1.length < 10 && n2.length < 10) {
    alert("Kam se kam ek valid number daalo");
    return;
  }

  if (n1) localStorage.setItem("parent1", n1);
  if (n2) localStorage.setItem("parent2", n2);

  location.reload();
}

function changeNumbers() {
  if (confirm("Parent numbers change karna hai?")) {
    localStorage.removeItem("parent1");
    localStorage.removeItem("parent2");
    location.reload();
  }
}

function startSOS() {

  // ðŸ”Š Siren
  const siren = document.getElementById("siren");
  siren.volume = 1.0;
  siren.play();

  // ðŸ“ Location + WhatsApp
  navigator.geolocation.getCurrentPosition(pos => {

    const lat = pos.coords.latitude;
    const lon = pos.coords.longitude;
    const map = "https://maps.google.com/?q=" + lat + "," + lon;

    const msg =
      "ðŸš¨ SOS ALERT â€“ Safe Sakhi\n\n" +
      "I need help urgently.\n\n" +
      "ðŸ“ Live Location:\n" + map +
      "\n\nPlease call me immediately.";

    if (p1) {
      window.open(
        "https://wa.me/" + p1 + "?text=" + encodeURIComponent(msg),
        "_blank"
      );
    }

    if (p2) {
      setTimeout(() => {
        window.open(
          "https://wa.me/" + p2 + "?text=" + encodeURIComponent(msg),
          "_blank"
        );
      }, 600);
    }

  });

  // ðŸ“ž Call 112
  setTimeout(() => {
    window.location.href = "tel:112";
  }, 900);
}
</script>

</body>
</html>
