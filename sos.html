<!DOCTYPE html>
<html>
<head>
  <title>Safe Sakhi SOS</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body style="margin:0;height:100vh;display:flex;
justify-content:center;align-items:center;background:#8b0000;color:white;">

<div id="setup" style="display:none;text-align:center;">
  <h2>Set Parent WhatsApp Numbers</h2>
  <input id="p1" type="tel" placeholder="Parent 1 (91XXXXXXXXXX)"
    style="font-size:18px;padding:10px;width:240px;"><br><br>
  <input id="p2" type="tel" placeholder="Parent 2 (91XXXXXXXXXX)"
    style="font-size:18px;padding:10px;width:240px;"><br><br>
  <button onclick="save()">Save Numbers</button>
</div>

<div id="sos" style="display:none;text-align:center;">
  <button onclick="startSOS()" style="
    background:red;color:white;font-size:32px;
    padding:32px 60px;border:none;border-radius:20px;">
    ğŸš¨ SOS
  </button>
  <p id="status" style="margin-top:15px;font-size:16px;"></p>
</div>

<audio id="siren" loop>
  <source src="siren.mp3" type="audio/mpeg">
</audio>

<script>
function check() {
  if (localStorage.getItem("p1") || localStorage.getItem("p2")) {
    document.getElementById("sos").style.display = "block";
  } else {
    document.getElementById("setup").style.display = "block";
  }
}
check();

function save() {
  const n1 = document.getElementById("p1").value.trim();
  const n2 = document.getElementById("p2").value.trim();
  if (!n1 && !n2) {
    alert("Kam se kam ek number daalo");
    return;
  }
  if (n1) localStorage.setItem("p1", n1);
  if (n2) localStorage.setItem("p2", n2);
  location.reload();
}

function startSOS() {

  // ğŸ”Š 1. Siren FIRST
  const siren = document.getElementById("siren");
  siren.volume = 1.0;
  siren.play();

  document.getElementById("status").innerText =
    "ğŸš¨ Siren ON â€¢ Getting location...";

  // ğŸ“ 2. Location + WhatsApp
  navigator.geolocation.getCurrentPosition(pos => {

    const map =
      "https://maps.google.com/?q=" +
      pos.coords.latitude + "," + pos.coords.longitude;

    document.getElementById("status").innerText =
      "ğŸ“ Location detected â€¢ Informing parents";

    const msg =
      "ğŸš¨ SOS ALERT â€“ Safe Sakhi\n\n" +
      "I need help urgently.\n\nğŸ“ Location:\n" +
      map + "\n\nPlease call me immediately.";

    const p1 = localStorage.getItem("p1");
    const p2 = localStorage.getItem("p2");

    if (p1) window.open("https://wa.me/" + p1 + "?text=" + encodeURIComponent(msg), "_blank");
    if (p2) setTimeout(() =>
      window.open("https://wa.me/" + p2 + "?text=" + encodeURIComponent(msg), "_blank"), 600);

  });

  // ğŸ“ 3. CALL 112 (DELAYED)
  setTimeout(() => {
    window.location.href = "tel:112";
  }, 2000); // â± 2 sec delay (IMPORTANT)
}
</script>

</body>
</html>
