<!DOCTYPE html>
<html>
<head>
  <title>Safe Sakhi SOS</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body id="body" style="margin:0;height:100vh;display:flex;
justify-content:center;align-items:center;background:#8b0000;">

<div id="setup" style="display:none;text-align:center;">
  <h2 style="color:white;">Set Parent WhatsApp Number</h2>
  <input id="parentNo" type="tel" placeholder="91XXXXXXXXXX"
    style="font-size:18px;padding:10px;width:220px;">
  <br><br>
  <button onclick="saveNumber()" style="font-size:18px;padding:10px;">
    Save Number
  </button>
</div>

<div id="sos" style="display:none;">
  <button onclick="startSOS()" style="
    background:red;color:white;font-size:30px;
    padding:30px 50px;border:none;border-radius:18px;">
    ðŸš¨ SOS
  </button>
</div>

<audio id="siren" loop>
  <source src="siren.mp3" type="audio/mpeg">
</audio>

<script>
const savedNumber = localStorage.getItem("parentNumber");

if (savedNumber) {
  document.getElementById("sos").style.display = "block";
} else {
  document.getElementById("setup").style.display = "block";
}

function saveNumber() {
  const no = document.getElementById("parentNo").value;
  if (no.length < 10) {
    alert("Valid number daalo");
    return;
  }
  localStorage.setItem("parentNumber", no);
  location.reload();
}

function startSOS() {

  // Siren
  const siren = document.getElementById("siren");
  siren.play();

  // Location + WhatsApp
  navigator.geolocation.getCurrentPosition(pos => {

    const lat = pos.coords.latitude;
    const lon = pos.coords.longitude;
    const map = "https://maps.google.com/?q=" + lat + "," + lon;

    const msg =
      "ðŸš¨ SOS ALERT â€“ Safe Sakhi\n\n" +
      "I need help urgently.\n\nðŸ“ Location:\n" + map +
      "\n\nPlease call me immediately.";

    const parent = localStorage.getItem("parentNumber");
    window.open(
      "https://wa.me/" + parent +
      "?text=" + encodeURIComponent(msg),
      "_blank"
    );
  });

  // Call 112
  setTimeout(() => {
    window.location.href = "tel:112";
  }, 800);
}
</script>

</body>
</html>
